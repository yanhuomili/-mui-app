<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title></title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">

		<link rel="stylesheet" href="css/mui.min.css">
		<link rel="stylesheet" href="css/shop-car.css">
		<link rel="stylesheet" href="css/reset.css">
		<link rel="stylesheet" href="css/app.css">
		
	</head>

	<body>
		<div id="pullrefresh" class="mui-content mui-scroll-wrapper">
			<div class="mui-scroll good">
		    	<ul class="mui-table-view list mui-table-view-chevron">
				    <li class="mui-table-view-cell mui-media">
				    	<button class="circle active"></button>
				        <a href="javascript:;">
				            <img class="mui-media-object mui-pull-left" src="img/hz1.jpg">
				            <div class="mui-media-body">
				                <p class="text">白云区云城西路89号</p>
				                <p class="">属性：<span>265g/袋</span></p>
				                <div class="sba N">
				                	<i>&yen; 59.9</i>
				                	<div class="num mui-numbox" data-numbox-min="1">
									  <!-- "-"按钮，点击可减小当前数值 -->
									  <button class="mui-btn mui-numbox-btn-minus" type="button">-</button>
									  <input class="mui-numbox-input" type="number" />
									  <!-- "+"按钮，点击可增大当前数值 -->
									  <button class="mui-btn mui-numbox-btn-plus" type="button">+</button>
									</div>
				                </div>
				            </div>
				        </a>
				    </li>
				    <li class="mui-table-view-cell mui-media">
				    	<button class="circle "></button>
				        <a href="javascript:;">
				            <img class="mui-media-object mui-pull-left" src="img/hz1.jpg">
				            <div class="mui-media-body">
				                <p class="text">白云区云城西路89号</p>
				                <p class="">属性：<span>265g/袋</span></p>
				                <div class="sba N">
				                	<i>&yen; 59.9</i>
				                	<div class="num mui-numbox" data-numbox-min="1">
									  <!-- "-"按钮，点击可减小当前数值 -->
									  <button class="mui-btn mui-numbox-btn-minus" type="button">-</button>
									  <input class="mui-numbox-input" type="number" />
									  <!-- "+"按钮，点击可增大当前数值 -->
									  <button class="mui-btn mui-numbox-btn-plus" type="button">+</button>
									</div>
				                </div>
				            </div>
				        </a>
				    </li>
				    <li class="mui-table-view-cell mui-media">
				    	<button class="circle "></button>
				        <a href="javascript:;">
				            <img class="mui-media-object mui-pull-left" src="img/hz1.jpg">
				            <div class="mui-media-body">
				                <p class="text">白云区云城西路89号</p>
				                <p class="">属性：<span>265g/袋</span></p>
				                <div class="sba N">
				                	<i>&yen; 59.9</i>
				                	<div class="num mui-numbox" data-numbox-min="1">
									  <!-- "-"按钮，点击可减小当前数值 -->
									  <button class="mui-btn mui-numbox-btn-minus" type="button">-</button>
									  <input class="mui-numbox-input" type="number" />
									  <!-- "+"按钮，点击可增大当前数值 -->
									  <button class="mui-btn mui-numbox-btn-plus" type="button">+</button>
									</div>
				                </div>
				            </div>
				        </a>
				    </li>
				    <li class="mui-table-view-cell mui-media">
				    	<button class="circle "></button>
				        <a href="javascript:;">
				            <img class="mui-media-object mui-pull-left" src="img/hz1.jpg">
				            <div class="mui-media-body">
				                <p class="text">白云区云城西路89号</p>
				                <p class="">属性：<span>265g/袋</span></p>
				                <div class="sba N">
				                	<i>&yen; 59.9</i>
				                	<div class="num mui-numbox" data-numbox-min="1">
									  <!-- "-"按钮，点击可减小当前数值 -->
									  <button class="mui-btn mui-numbox-btn-minus" type="button">-</button>
									  <input class="mui-numbox-input" type="number" />
									  <!-- "+"按钮，点击可增大当前数值 -->
									  <button class="mui-btn mui-numbox-btn-plus" type="button">+</button>
									</div>
				                </div>
				            </div>
				        </a>
				    </li>
				    <li class="mui-table-view-cell mui-media">
				    	<button class="circle "></button>
				        <a href="javascript:;">
				            <img class="mui-media-object mui-pull-left" src="img/hz1.jpg">
				            <div class="mui-media-body">
				                <p class="text">白云区云城西路89号</p>
				                <p class="">属性：<span>265g/袋</span></p>
				                <div class="sba N">
				                	<i>&yen; 59.9</i>
				                	<div class="num mui-numbox" data-numbox-min="1">
									  <!-- "-"按钮，点击可减小当前数值 -->
									  <button class="mui-btn mui-numbox-btn-minus" type="button">-</button>
									  <input class="mui-numbox-input" type="number" />
									  <!-- "+"按钮，点击可增大当前数值 -->
									  <button class="mui-btn mui-numbox-btn-plus" type="button">+</button>
									</div>
				                </div>
				            </div>
				        </a>
				    </li>
				    <li class="mui-table-view-cell mui-media">
				    	<button class="circle "></button>
				        <a href="javascript:;">
				            <img class="mui-media-object mui-pull-left" src="img/hz1.jpg">
				            <div class="mui-media-body">
				                <p class="text">白云区云城西路89号</p>
				                <p class="">属性：<span>265g/袋</span></p>
				                <div class="sba N">
				                	<i>&yen; 59.9</i>
				                	<div class="num mui-numbox" data-numbox-min="1">
									  <!-- "-"按钮，点击可减小当前数值 -->
									  <button class="mui-btn mui-numbox-btn-minus" type="button">-</button>
									  <input class="mui-numbox-input" type="number" />
									  <!-- "+"按钮，点击可增大当前数值 -->
									  <button class="mui-btn mui-numbox-btn-plus" type="button">+</button>
									</div>
				                </div>
				            </div>
				        </a>
				    </li>
				    <li class="mui-table-view-cell mui-media">
				    	<button class="circle "></button>
				        <a href="javascript:;">
				            <img class="mui-media-object mui-pull-left" src="img/hz1.jpg">
				            <div class="mui-media-body">
				                <p class="text">白云区云城西路89号</p>
				                <p class="">属性：<span>265g/袋</span></p>
				                <div class="sba N">
				                	<i>&yen; 59.9</i>
				                	<div class="num mui-numbox" data-numbox-min="1">
									  <!-- "-"按钮，点击可减小当前数值 -->
									  <button class="mui-btn mui-numbox-btn-minus" type="button">-</button>
									  <input class="mui-numbox-input" type="number" />
									  <!-- "+"按钮，点击可增大当前数值 -->
									  <button class="mui-btn mui-numbox-btn-plus" type="button">+</button>
									</div>
				                </div>
				            </div>
				        </a>
				    </li>
				</ul>
			</div>
			<div class="footer sba">
				<div class="saa"><p class="saa"><i class="all"></i><span>全选</span></p><p>实付:<span class="total">&yen; 66</span></p></div>
				<button id="js">结算(<span class="total-goods">2</span>)</button>
			</div>
		</div>
		<script src="js/mui.min.js"></script>
		<script>
			mui.init({
				pullRefresh: {
						container: '#pullrefresh',
						down: {
							callback: pulldownRefresh
						},
						up: {
							contentrefresh: '正在加载...',
							callback: pullupRefresh
						}
					}
				});
			
			
			/**
			 * 下拉刷新具体业务实现
			 */
			function pulldownRefresh() {
				setTimeout(function() {
					var table = document.body.querySelector('.mui-table-view');
					var cells = document.body.querySelectorAll('.mui-table-view-cell');
					for (var i = cells.length, len = i + 3; i < len; i++) {
						var li = document.createElement('li');
						li.className = 'mui-table-view-cell';
						li.innerHTML = '<a class="mui-navigate-right">Item ' + (i + 1) + '</a>';
						//下拉刷新，新纪录插到最前面；
//						table.insertBefore(li, table.firstChild);
					}
					mui('#pullrefresh').pullRefresh().endPulldownToRefresh(); //refresh completed
				}, 1500);
			}
			var count = 0;
			/**
			 * 上拉加载具体业务实现
			 */
			function pullupRefresh() {
				setTimeout(function() {
					mui('#pullrefresh').pullRefresh().endPullupToRefresh((++count > 2)); //参数为true代表没有更多数据了。
					var table = document.body.querySelector('.mui-table-view');
					var cells = document.body.querySelectorAll('.mui-table-view-cell');
					for (var i=0; i<3; i++) {
						var li = document.createElement('li');
						li.className = 'mui-table-view-cell mui-media';
						li.innerHTML = '<button class="circle "></button>'
								        +'<a href="javascript:;">'
								            +'<img class="mui-media-object mui-pull-left" src="img/hz1.jpg">'
								            +'<div class="mui-media-body">'
								                +'<p class="text">白云区云城西路89号</p>'
								                +'<p class="">属性：<span>265g/袋</span></p>'
								                +'<div class="sba N">'
								                	+'<i>&yen; 59.9</i>'
								                	+'<div class="num mui-numbox" data-numbox-min="1">'
													  +'<button class="mui-btn mui-numbox-btn-minus" type="button">-</button>'
													  +'<input class="mui-numbox-input" type="number" />'
													  +'<button class="mui-btn mui-numbox-btn-plus" type="button">+</button>'
													+'</div>'
								                +'</div>'
								            +'</div>'
								        +'</a>';
						table.appendChild(li);
					}
					mui('.mui-numbox').each(function(index,el){
						mui(el).numbox()
					})
				}, 1500);
			}
			//进入页面执行一次上拉加载事件
			if (mui.os.plus) {
				mui.plusReady(function() {
					setTimeout(function() {
						mui('#pullrefresh').pullRefresh().pullupLoading();
					}, 1000);

				});
			} else {
				mui.ready(function() {
					mui('#pullrefresh').pullRefresh().pullupLoading();
				});
			}
			
			//单选按钮
			mui('.list').on('tap','.circle',function(){
				var name=this.className;
				var li=this.parentNode.parentNode.children;
				var len=li.length;
				var n=0;
				
				if(name.indexOf('active')>-1){
					this.className="circle";
				}else{
					this.className="circle active";
				}
				
				for(var i=0;i<len;i++){
					var liName=li[i].firstElementChild.className;
					if(liName.indexOf('active')>-1){
						n++;
					}
				}
				if(n==len){
					mui('.all')[0].className="all active";
				}else{
					mui('.all')[0].className="all";
				}
				n=0;
				goodsNum();
			})
			
			
			//全选按钮
			mui('.all')[0].addEventListener('tap',function(){
				var name=this.className;
				if(name.indexOf('active')>-1){
					this.className="all";
					allChoose(0)
				}else{
					this.className="all active";
					allChoose(1)
				}
				goodsNum();
			},false)
			
			//全选和全部选方法
			var allChoose=function(n){
				var circle=document.getElementsByClassName('circle');
				if(n){
					for(var i=0;i<circle.length;i++){
						circle[i].className="circle active";
					}
				}else{
					for(var i=0;i<circle.length;i++){
						circle[i].className="circle";
					}
				}
			}
			
			//点击加减按钮
			mui('.num').on('tap','button',function(){
				goodsNum();
			})
			//直接修改商品数量
			mui('.num').on('input','input',function(){
				goodsNum();
			})
			
			//计算商品数量
			var goodsNum=function(){
				var circle=document.getElementsByClassName('circle');
				var totalNum=0;
				for(var i=0;i<circle.length;i++){
					var name=circle[i].className;
					console.log(name)
					if(name.indexOf('active')>-1){
						var n=circle[i].nextElementSibling.children[1].children[2].children[1].children[1].value
						n=n-0;
						totalNum+=n;
					}else{
						continue;
					}
				}
				mui('.total-goods')[0].innerText=totalNum;
				console.log(totalNum)
			}
		</script>
	</body>

</html>